{"ast":null,"code":"// state object//\nvar setVertexAttribArrays = require('./setVertexAttribArrays');\n\n/**\n * Helper class to work with WebGL VertexArrayObjects (vaos)\n * Only works if WebGL extensions are enabled (they usually are)\n *\n * @class\n * @memberof PIXI.glCore\n * @param gl {WebGLRenderingContext} The current WebGL rendering context\n */\nfunction VertexArrayObject(gl, state) {\n  this.nativeVaoExtension = null;\n  if (!VertexArrayObject.FORCE_NATIVE) {\n    this.nativeVaoExtension = gl.getExtension('OES_vertex_array_object') || gl.getExtension('MOZ_OES_vertex_array_object') || gl.getExtension('WEBKIT_OES_vertex_array_object');\n  }\n  this.nativeState = state;\n  if (this.nativeVaoExtension) {\n    this.nativeVao = this.nativeVaoExtension.createVertexArrayOES();\n    var maxAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n    // VAO - overwrite the state..\n    this.nativeState = {\n      tempAttribState: new Array(maxAttribs),\n      attribState: new Array(maxAttribs)\n    };\n  }\n\n  /**\n   * The current WebGL rendering context\n   *\n   * @member {WebGLRenderingContext}\n   */\n  this.gl = gl;\n\n  /**\n   * An array of attributes\n   *\n   * @member {Array}\n   */\n  this.attributes = [];\n\n  /**\n   * @member {PIXI.glCore.GLBuffer}\n   */\n  this.indexBuffer = null;\n\n  /**\n   * A boolean flag\n   *\n   * @member {Boolean}\n   */\n  this.dirty = false;\n}\nVertexArrayObject.prototype.constructor = VertexArrayObject;\nmodule.exports = VertexArrayObject;\n\n/**\n* Some devices behave a bit funny when using the newer extensions (im looking at you ipad 2!)\n* If you find on older devices that things have gone a bit weird then set this to true.\n*/\n/**\n * Lets the VAO know if you should use the WebGL extension or the native methods.\n * Some devices behave a bit funny when using the newer extensions (im looking at you ipad 2!)\n * If you find on older devices that things have gone a bit weird then set this to true.\n * @static\n * @property {Boolean} FORCE_NATIVE\n */\nVertexArrayObject.FORCE_NATIVE = false;\n\n/**\n * Binds the buffer\n */\nVertexArrayObject.prototype.bind = function () {\n  if (this.nativeVao) {\n    this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);\n    if (this.dirty) {\n      this.dirty = false;\n      this.activate();\n      return this;\n    }\n    if (this.indexBuffer) {\n      this.indexBuffer.bind();\n    }\n  } else {\n    this.activate();\n  }\n  return this;\n};\n\n/**\n * Unbinds the buffer\n */\nVertexArrayObject.prototype.unbind = function () {\n  if (this.nativeVao) {\n    this.nativeVaoExtension.bindVertexArrayOES(null);\n  }\n  return this;\n};\n\n/**\n * Uses this vao\n */\nVertexArrayObject.prototype.activate = function () {\n  var gl = this.gl;\n  var lastBuffer = null;\n  for (var i = 0; i < this.attributes.length; i++) {\n    var attrib = this.attributes[i];\n    if (lastBuffer !== attrib.buffer) {\n      attrib.buffer.bind();\n      lastBuffer = attrib.buffer;\n    }\n    gl.vertexAttribPointer(attrib.attribute.location, attrib.attribute.size, attrib.type || gl.FLOAT, attrib.normalized || false, attrib.stride || 0, attrib.start || 0);\n  }\n  setVertexAttribArrays(gl, this.attributes, this.nativeState);\n  if (this.indexBuffer) {\n    this.indexBuffer.bind();\n  }\n  return this;\n};\n\n/**\n *\n * @param buffer     {PIXI.gl.GLBuffer}\n * @param attribute  {*}\n * @param type       {String}\n * @param normalized {Boolean}\n * @param stride     {Number}\n * @param start      {Number}\n */\nVertexArrayObject.prototype.addAttribute = function (buffer, attribute, type, normalized, stride, start) {\n  this.attributes.push({\n    buffer: buffer,\n    attribute: attribute,\n    location: attribute.location,\n    type: type || this.gl.FLOAT,\n    normalized: normalized || false,\n    stride: stride || 0,\n    start: start || 0\n  });\n  this.dirty = true;\n  return this;\n};\n\n/**\n *\n * @param buffer   {PIXI.gl.GLBuffer}\n */\nVertexArrayObject.prototype.addIndex = function (buffer /*, options*/) {\n  this.indexBuffer = buffer;\n  this.dirty = true;\n  return this;\n};\n\n/**\n * Unbinds this vao and disables it\n */\nVertexArrayObject.prototype.clear = function () {\n  // var gl = this.gl;\n\n  // TODO - should this function unbind after clear?\n  // for now, no but lets see what happens in the real world!\n  if (this.nativeVao) {\n    this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);\n  }\n  this.attributes.length = 0;\n  this.indexBuffer = null;\n  return this;\n};\n\n/**\n * @param type  {Number}\n * @param size  {Number}\n * @param start {Number}\n */\nVertexArrayObject.prototype.draw = function (type, size, start) {\n  var gl = this.gl;\n  if (this.indexBuffer) {\n    gl.drawElements(type, size || this.indexBuffer.data.length, gl.UNSIGNED_SHORT, (start || 0) * 2);\n  } else {\n    // TODO need a better way to calculate size..\n    gl.drawArrays(type, start, size || this.getSize());\n  }\n  return this;\n};\n\n/**\n * Destroy this vao\n */\nVertexArrayObject.prototype.destroy = function () {\n  // lose references\n  this.gl = null;\n  this.indexBuffer = null;\n  this.attributes = null;\n  this.nativeState = null;\n  if (this.nativeVao) {\n    this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao);\n  }\n  this.nativeVaoExtension = null;\n  this.nativeVao = null;\n};\nVertexArrayObject.prototype.getSize = function () {\n  var attrib = this.attributes[0];\n  return attrib.buffer.data.length / (attrib.stride / 4 || attrib.attribute.size);\n};","map":{"version":3,"names":["setVertexAttribArrays","require","VertexArrayObject","gl","state","nativeVaoExtension","FORCE_NATIVE","getExtension","nativeState","nativeVao","createVertexArrayOES","maxAttribs","getParameter","MAX_VERTEX_ATTRIBS","tempAttribState","Array","attribState","attributes","indexBuffer","dirty","prototype","constructor","module","exports","bind","bindVertexArrayOES","activate","unbind","lastBuffer","i","length","attrib","buffer","vertexAttribPointer","attribute","location","size","type","FLOAT","normalized","stride","start","addAttribute","push","addIndex","clear","draw","drawElements","data","UNSIGNED_SHORT","drawArrays","getSize","destroy","deleteVertexArrayOES"],"sources":["/Users/jiahuajiang/node_modules/pixi-gl-core/src/VertexArrayObject.js"],"sourcesContent":["\n// state object//\nvar setVertexAttribArrays = require( './setVertexAttribArrays' );\n\n/**\n * Helper class to work with WebGL VertexArrayObjects (vaos)\n * Only works if WebGL extensions are enabled (they usually are)\n *\n * @class\n * @memberof PIXI.glCore\n * @param gl {WebGLRenderingContext} The current WebGL rendering context\n */\nfunction VertexArrayObject(gl, state)\n{\n    this.nativeVaoExtension = null;\n\n    if(!VertexArrayObject.FORCE_NATIVE)\n    {\n        this.nativeVaoExtension = gl.getExtension('OES_vertex_array_object') ||\n                                  gl.getExtension('MOZ_OES_vertex_array_object') ||\n                                  gl.getExtension('WEBKIT_OES_vertex_array_object');\n    }\n\n    this.nativeState = state;\n\n    if(this.nativeVaoExtension)\n    {\n        this.nativeVao = this.nativeVaoExtension.createVertexArrayOES();\n\n        var maxAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n        // VAO - overwrite the state..\n        this.nativeState = {\n            tempAttribState: new Array(maxAttribs),\n            attribState: new Array(maxAttribs)\n        };\n    }\n\n    /**\n     * The current WebGL rendering context\n     *\n     * @member {WebGLRenderingContext}\n     */\n    this.gl = gl;\n\n    /**\n     * An array of attributes\n     *\n     * @member {Array}\n     */\n    this.attributes = [];\n\n    /**\n     * @member {PIXI.glCore.GLBuffer}\n     */\n    this.indexBuffer = null;\n\n    /**\n     * A boolean flag\n     *\n     * @member {Boolean}\n     */\n    this.dirty = false;\n}\n\nVertexArrayObject.prototype.constructor = VertexArrayObject;\nmodule.exports = VertexArrayObject;\n\n/**\n* Some devices behave a bit funny when using the newer extensions (im looking at you ipad 2!)\n* If you find on older devices that things have gone a bit weird then set this to true.\n*/\n/**\n * Lets the VAO know if you should use the WebGL extension or the native methods.\n * Some devices behave a bit funny when using the newer extensions (im looking at you ipad 2!)\n * If you find on older devices that things have gone a bit weird then set this to true.\n * @static\n * @property {Boolean} FORCE_NATIVE\n */\nVertexArrayObject.FORCE_NATIVE = false;\n\n/**\n * Binds the buffer\n */\nVertexArrayObject.prototype.bind = function()\n{\n    if(this.nativeVao)\n    {\n        this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);\n\n        if(this.dirty)\n        {\n            this.dirty = false;\n            this.activate();\n            return this;\n        }\n        if (this.indexBuffer)\n        {\n            this.indexBuffer.bind();\n        }\n    }\n    else\n    {\n        this.activate();\n    }\n\n    return this;\n};\n\n/**\n * Unbinds the buffer\n */\nVertexArrayObject.prototype.unbind = function()\n{\n    if(this.nativeVao)\n    {\n        this.nativeVaoExtension.bindVertexArrayOES(null);\n    }\n\n    return this;\n};\n\n/**\n * Uses this vao\n */\nVertexArrayObject.prototype.activate = function()\n{\n\n    var gl = this.gl;\n    var lastBuffer = null;\n\n    for (var i = 0; i < this.attributes.length; i++)\n    {\n        var attrib = this.attributes[i];\n\n        if(lastBuffer !== attrib.buffer)\n        {\n            attrib.buffer.bind();\n            lastBuffer = attrib.buffer;\n        }\n\n        gl.vertexAttribPointer(attrib.attribute.location,\n                               attrib.attribute.size,\n                               attrib.type || gl.FLOAT,\n                               attrib.normalized || false,\n                               attrib.stride || 0,\n                               attrib.start || 0);\n    }\n\n    setVertexAttribArrays(gl, this.attributes, this.nativeState);\n\n    if(this.indexBuffer)\n    {\n        this.indexBuffer.bind();\n    }\n\n    return this;\n};\n\n/**\n *\n * @param buffer     {PIXI.gl.GLBuffer}\n * @param attribute  {*}\n * @param type       {String}\n * @param normalized {Boolean}\n * @param stride     {Number}\n * @param start      {Number}\n */\nVertexArrayObject.prototype.addAttribute = function(buffer, attribute, type, normalized, stride, start)\n{\n    this.attributes.push({\n        buffer:     buffer,\n        attribute:  attribute,\n\n        location:   attribute.location,\n        type:       type || this.gl.FLOAT,\n        normalized: normalized || false,\n        stride:     stride || 0,\n        start:      start || 0\n    });\n\n    this.dirty = true;\n\n    return this;\n};\n\n/**\n *\n * @param buffer   {PIXI.gl.GLBuffer}\n */\nVertexArrayObject.prototype.addIndex = function(buffer/*, options*/)\n{\n    this.indexBuffer = buffer;\n\n    this.dirty = true;\n\n    return this;\n};\n\n/**\n * Unbinds this vao and disables it\n */\nVertexArrayObject.prototype.clear = function()\n{\n    // var gl = this.gl;\n\n    // TODO - should this function unbind after clear?\n    // for now, no but lets see what happens in the real world!\n    if(this.nativeVao)\n    {\n        this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);\n    }\n\n    this.attributes.length = 0;\n    this.indexBuffer = null;\n\n    return this;\n};\n\n/**\n * @param type  {Number}\n * @param size  {Number}\n * @param start {Number}\n */\nVertexArrayObject.prototype.draw = function(type, size, start)\n{\n    var gl = this.gl;\n\n    if(this.indexBuffer)\n    {\n        gl.drawElements(type, size || this.indexBuffer.data.length, gl.UNSIGNED_SHORT, (start || 0) * 2 );\n    }\n    else\n    {\n        // TODO need a better way to calculate size..\n        gl.drawArrays(type, start, size || this.getSize());\n    }\n\n    return this;\n};\n\n/**\n * Destroy this vao\n */\nVertexArrayObject.prototype.destroy = function()\n{\n    // lose references\n    this.gl = null;\n    this.indexBuffer = null;\n    this.attributes = null;\n    this.nativeState = null;\n\n    if(this.nativeVao)\n    {\n        this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao);\n    }\n\n    this.nativeVaoExtension = null;\n    this.nativeVao = null;\n};\n\nVertexArrayObject.prototype.getSize = function()\n{\n    var attrib = this.attributes[0];\n    return attrib.buffer.data.length / (( attrib.stride/4 ) || attrib.attribute.size);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}